!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@ngrx/entity"),require("@ngrx/store"),require("lodash"),require("@angular/core"),require("@angular/common"),require("@ngrx/effects"),require("rxjs/operators"),require("rxjs"),require("@hisptz/ngx-dhis2-http-client"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("@hisptz/ngx-dhis2-dictionary",["exports","@ngrx/entity","@ngrx/store","lodash","@angular/core","@angular/common","@ngrx/effects","rxjs/operators","rxjs","@hisptz/ngx-dhis2-http-client","@angular/common/http"],e):e((t.hisptz=t.hisptz||{},t.hisptz["ngx-dhis2-dictionary"]={}),null,null,null,t.ng.core,t.ng.common,null,t.rxjs.operators,t.rxjs,null,t.ng.common.http)}(this,function(t,e,i,o,a,r,s,d,c,g,n){"use strict";var p="[Dictionary] initialize incoming metadata",l="[Dictionary] add dictionary metadata list",m="[Dictionary] update dictionary metadata list",u=function f(t){this.dictionaryMetadataIdentifiers=t,this.type=p},h=function y(t){this.dictionaryMetadataList=t,this.type=l},b=function v(t,e){this.dictionaryMetadataId=t,this.changes=e,this.type=m},x=e.createEntityAdapter(),S=x.getInitialState({});function I(t,e){switch(void 0===t&&(t=S),e.type){case l:return x.addMany(e.dictionaryMetadataList,t);case m:return x.updateOne({id:e.dictionaryMetadataId,changes:e.changes},t)}return t}var C=i.createFeatureSelector("dictionary"),D=x.getSelectors(C).selectEntities,E=function(t){return i.createSelector(D,function(e){return o.filter(o.map(t,function(t){return e[t]}),function(t){return t})})},w=function(){function t(t){this.store=t,this.activeItem=0}return t.prototype.ngOnInit=function(){0<this.metadataIdentifiers.length&&(this.store.dispatch(new u(this.metadataIdentifiers)),this.dictionaryList$=this.store.select(E(this.metadataIdentifiers)))},t.prototype.setActiveItem=function(t,e){e.stopPropagation(),this.activeItem===t?this.activeItem=-1:this.activeItem=t},t.decorators=[{type:a.Component,args:[{selector:"ngx-dhis2-dictionary-list",template:'<div class="dictionary-list-container">\n  <div\n    class="dictionary-item-container"\n    *ngFor="let dictionaryItem of dictionaryList$ | async; let i = index"\n  >\n    <div\n      class="dictionary-title"\n      (click)="setActiveItem(i, $event)"\n    >\n      <span>{{ dictionaryItem.name }}</span>\n      <div *ngIf="!dictionaryItem.name">\n        <app-dictionary-progress></app-dictionary-progress>\n      </div>\n    </div>\n    <div\n      class="dictionary-body"\n      *ngIf="activeItem === i"\n    >\n      <div class="dictionary-description" [innerHtml]="dictionaryItem.description"></div>\n      <div *ngIf="dictionaryItem.progress.loading">\n        <app-dictionary-progress></app-dictionary-progress>\n      </div>\n    </div>\n  </div>\n</div>\n',styles:[".dictionary-list-container{box-shadow:0 0 3px rgba(0,0,0,.3)}.dictionary-item-container{border-bottom:thin solid #ececec}.dictionary-title{padding:5px 10px;cursor:pointer}.dictionary-item-container:last-child{border-bottom-style:none}.dictionary-body{border-top:thin solid #ececec;padding:10px}.dictionary-description{text-align:justify}"],changeDetection:a.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:i.Store}]},t.propDecorators={metadataIdentifiers:[{type:a.Input}]},t}(),O=function(){function t(){}return t.prototype.ngOnInit=function(){},t.decorators=[{type:a.Component,args:[{selector:"app-dictionary-progress",template:'<div class="dictionary-progress">\n    <div class="animated-background"></div>\n</div>',styles:[".dictionary-progress div{height:5px;margin-top:3px}@-webkit-keyframes placeHolderShimmer{0%{background-position:-468px 0}100%{background-position:468px 0}}@keyframes placeHolderShimmer{0%{background-position:-468px 0}100%{background-position:468px 0}}.animated-background{-webkit-animation-duration:1.5s;animation-duration:1.5s;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-name:placeHolderShimmer;animation-name:placeHolderShimmer;-webkit-animation-timing-function:linear;animation-timing-function:linear;background:#f6f7f8;background:linear-gradient(to right,#eee 8%,#ddd 18%,#eee 33%);background-size:800px 104px;height:100%;position:relative}"]}]}],t.ctorParameters=function(){return[]},t}();var k=function(){function t(t,e,n,i){var a=this;this.actions$=t,this.store=e,this.httpClient=n,this.datePipe=i,this.initializeDictionary$=this.actions$.pipe(s.ofType(p),d.mergeMap(function(t){return a.store.select(E(t.dictionaryMetadataIdentifiers)).pipe(d.map(function(e){return o.filter(t.dictionaryMetadataIdentifiers,function(t){return!o.find(e,["id",t])})}))}),d.tap(function(t){a.store.dispatch(new h(o.map(t,function(t){return{id:t,name:"",description:"",progress:{loading:!0,loadingSucceeded:!1,loadingFailed:!1}}}))),c.from(t).pipe(d.mergeMap(function(t){return a.httpClient.get("identifiableObjects/"+t+".json",!0)})).subscribe(function(t){if(a.store.dispatch(new b(t.id,{name:t.name,progress:{loading:!0,loadingSucceeded:!0,loadingFailed:!1}})),t.href&&-1!==t.href.indexOf("indicator")){var e="indicators/"+t.id+".json?fields=:all,displayName,id,name,numeratorDescription,denominatorDescription,denominator,numerator,annualized,decimals,indicatorType[name],user[name],attributeValues[value,attribute[name]],indicatorGroups[name,indicators~size],legendSet[name,symbolizer,legends~size],dataSets[name]";a.getIndicatorInfo(e,t.id)}else if(t.href&&-1!==t.href.indexOf("dataElement")){var n="dataElements/"+t.id+".json?fields=:all,id,name,aggregationType,displayName,categoryCombo[id,name,categories[id,name,categoryOptions[id,name]]],dataSets[:all,!compulsoryDataElementOperands]";a.getDataElementInfo(n,t.id)}else if(t.href&&-1!==t.href.indexOf("dataSet")){var i="dataSets/"+t.id+".json?fields=:all,user[:all],id,name,periodType,shortName,categoryCombo[id,name,categories[id,name,categoryOptions[id,name]]]";a.getDataSetInfo(i,t.id)}})}))}return t.prototype.getDataSetInfo=function(t,n){var a=this;this.httpClient.get(""+t,!0).subscribe(function(e){var i="<p>"+e.name+" of the <strong>"+e.formType+"</strong> Form created at <strong>"+a.datePipe.transform(e.created)+" by "+e.user.name+"</strong>";e.categoryCombo&&"default"!==e.categoryCombo.name&&(i+="<span> With <strong>"+e.categoryCombo.name+"</strong> Dimension which is divided into ",e.categoryCombo.categories.forEach(function(n,t){0!==t&&t!==e.categoryCombo.categories.length-1&&(i+=", "),t===e.categoryCombo.categories.length-1&&1<e.categoryCombo.categories.length&&(i+=" and "),i+="<strong>",n.categoryOptions.forEach(function(t,e){0!==e&&e!==n.categoryOptions.length-1&&(i+=", "),e===n.categoryOptions.length-1&&1<n.categoryOptions.length&&(i+=" and "),i+="<span>"+t.name+"</span>"}),i+="</strong>"}),i+="</span>"),i+="</p>",a.store.dispatch(new b(n,{description:i,progress:{loading:!1,loadingSucceeded:!0,loadingFailed:!1}}))})},t.prototype.getDataElementInfo=function(t,e){var n=this;this.httpClient.get(""+t,!0).subscribe(function(i){var a="<p>This "+i.name+" of this method of data aggregation <strong>"+i.aggregationType+"</strong> created at <strong>"+n.datePipe.transform(i.created)+"</strong> is only taking <strong>"+i.domainType+"</strong> data. As the culture of helping user not entering unrecognized data, therefore its only taking <strong>"+i.valueType+"</strong> values from the user input</p>";"default"!==i.categoryCombo.name&&(a+="<p><strong>"+i.name+"</strong> consists of <strong>"+i.categoryCombo.name+"</strong> category combinations of ",i.categoryCombo.categories.forEach(function(n,t){0!==t&&t!==i.categoryCombo.categories.length-1&&(a+=", "),t===i.categoryCombo.categories.length-1&&1<i.categoryCombo.categories.length&&(a+=" and "),a+="<strong>(",n.categoryOptions.forEach(function(t,e){0!==e&&e!==n.categoryOptions.length-1&&(a+=", "),e===n.categoryOptions.length-1&&1<n.categoryOptions.length&&(a+=" and "),a+="<span>"+t.name+"</span>"}),a+=")</strong> of the <strong>"+n.name+"</strong> category"}),a+="</strong></p>",i.dataSets&&0<i.dataSets.length&&(a+="<h5>"+i.name+" Sources</h5>",a+="<p>More than <strong>"+i.dataSets.length+"</strong> dataset ie ",i.dataSets.forEach(function(t,e){0!==e&&e!==i.dataSets.length-1&&(a+=", "),e===i.dataSets.length-1&&1<i.dataSets.length&&(a+=" and "),a+="<strong>"+t.name+"</strong>"}),a+=" use this "+i.name+" data element",i.dataElementGroups&&0<i.dataElementGroups.length&&(a+=" and it belongs to ",i.dataElementGroups.forEach(function(t,e){0!==e&&e!==i.dataElementGroups.length-1&&(a+=", "),e===i.dataElementGroups.length-1&&1<i.dataElementGroups.length&&(a+=" and "),a+="<strong>"+t.name+" Group</strong>"})),a+="</p>"),n.store.dispatch(new b(e,{description:a,progress:{loading:!1,loadingSucceeded:!0,loadingFailed:!1}})))})},t.prototype.getIndicatorInfo=function(t,e){var o=this;this.httpClient.get(""+t,!0).subscribe(function(i){var a="<p><strong>"+i.name+"</strong> is a <strong>"+i.indicatorType.name+" </strong> indicator";i.numeratorDescription&&(a+="<span> with the numerator described as <strong>"+i.numeratorDescription+"</strong></span>"),i.denominatorDescription&&(a+="<span> and denominator described as <strong>"+i.denominatorDescription+"</strong></span>"),a+="</p>",i.annualized&&(a+="<p><span>It’s figure is annualized to support analysis in less than year period (monthly,quarterly,semi-annually)</span></p>"),o.store.dispatch(new b(e,{description:a,progress:{loading:!0,loadingSucceeded:!0,loadingFailed:!1}})),c.forkJoin(o.httpClient.get("expressions/description?expression="+encodeURIComponent(i.numerator),!0),o.httpClient.get("dataSets.json?fields=periodType,id,name,timelyDays,formType,created,expiryDays&filter=dataSetElements.dataElement.id:in:["+o.getAvailableDataElements(i.numerator)+"]&paging=false",!0)).subscribe(function(t){if(t[0]&&(a+="<p>Numerator is calculated from <strong>"+t[0].description+"</strong>"),t[1]&&t[1].dataSets){var n=t[1].dataSets;0<n.length&&(a+=" originating from "),n.forEach(function(t,e){0!==e&&e!==n.length-1&&(a+=", "),e===n.length-1&&1<n.length&&(a+=" and "),a+="<span><strong>"+t.name+",</strong> that is collected <strong>"+t.periodType+"</strong> with deadline for submission after <strong>"+t.timelyDays+" days </strong></span>"})}a+="</p>",o.store.dispatch(new b(e,{description:a,progress:{loading:!0,loadingSucceeded:!0,loadingFailed:!1}})),c.forkJoin(o.httpClient.get("expressions/description?expression="+encodeURIComponent(i.denominator),!0),o.httpClient.get("dataSets.json?fields=periodType,id,name,timelyDays,formType,created,expiryDays&filter=dataSetElements.dataElement.id:in:["+o.getAvailableDataElements(i.denominator)+"]&paging=false",!0)).subscribe(function(t){if(t[0]&&(a+="<p>Denominator is calculated from <strong>"+t[0].description+"</strong>"),t[1]&&t[1].dataSets){var n=t[1].dataSets;0<n.length&&(a+=" originating from "),n.forEach(function(t,e){0!==e&&e!==n.length-1&&(a+=", "),e===n.length-1&&1<n.length&&(a+=" and "),a+="<span><strong>"+t.name+",</strong> that is collected <strong>"+t.periodType+"</strong> with deadline for submission after <strong>"+t.timelyDays+" days </strong></span>"})}a+="</p>",i.indicatorGroups&&0<i.indicatorGroups.length&&(a+="<div><p>It belongs to ",i.indicatorGroups.forEach(function(t,e){0!==e&&e!==i.indicatorGroups.length-1&&(a+=", "),e===i.indicatorGroups.length-1&&1<i.indicatorGroups.length&&(a+=" and "),a+="<span><strong>"+t.name+"</strong> with <strong>"+t.indicators+"</strong> other related indicators</span>"}),a+="</p></div>"),i.attributeValues&&0<i.attributeValues.length&&(a+="<div><p>Other related details associated with this indicators includes: ",i.attributeValues.forEach(function(t){a+="<span><strong>"+t.attribute.name+": "+t.value+"</strong></span>"}),a+="</p></div>"),i.legendSet&&(a+="<div><p> It makes use of: <strong>"+i.legendSet.name+"</strong> legend set for analysis with <strong>"+i.legendSet.legends+" Classes </strong>using <strong>"+i.legendSet.symbolizer+" for analysis</strong></p></div>"),i.user&&(a+="<div><p>This indicator was <strong> first created </strong> in the system on <strong>"+o.datePipe.transform(i.created)+"</strong> by <strong>"+i.user.name+"</strong></p></div>"),o.store.dispatch(new b(e,{description:a,progress:{loading:!1,loadingSucceeded:!0,loadingFailed:!1}}))})})})},t.prototype.getAvailableDataElements=function(t){var e=this,n=[];return t.split(new RegExp([" ","\\+","-","\\(","\\)","\\*","/",":","\\?"].join("|"),"g")).forEach(function(t){n=e.dataElementWithCategoryOptionCheck(t)}),n.join()},t.prototype.dataElementWithCategoryOptionCheck=function(t){var e=[];return 1<=t.indexOf(".")?e.push(t.replace(/#/g,"").replace(/{/g,"").replace(/}/g,"").split(".")[0]):e.push(t.replace(/#/g,"").replace(/{/g,"").replace(/}/g,"")),e},t.decorators=[{type:a.Injectable}],t.ctorParameters=function(){return[{type:s.Actions},{type:i.Store},{type:g.NgxDhis2HttpClientService},{type:r.DatePipe}]},function e(t,e,n,i){var a,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;0<=s;s--)(a=t[s])&&(r=(o<3?a(r):3<o?a(e,n,r):a(e,n))||r);return 3<o&&r&&Object.defineProperty(e,n,r),r}([s.Effect({dispatch:!1}),function n(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",c.Observable)],t.prototype,"initializeDictionary$",void 0),t}(),j=function(){function t(){}return t.decorators=[{type:a.NgModule,args:[{imports:[r.CommonModule,n.HttpClientModule,i.StoreModule.forFeature("dictionary",I),s.EffectsModule.forFeature([k])],declarations:[w,O],exports:[w],providers:[r.DatePipe]}]}],t}();t.NgxDhis2DictionaryModule=j,t.ɵd=w,t.ɵe=O,t.ɵc=k,t.ɵb=I,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=hisptz-ngx-dhis2-dictionary.umd.min.js.map