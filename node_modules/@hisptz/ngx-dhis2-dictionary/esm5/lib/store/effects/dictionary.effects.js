/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { DatePipe } from '@angular/common';
import { Store } from '@ngrx/store';
import { Actions, Effect, ofType } from '@ngrx/effects';
import * as _ from 'lodash';
import { mergeMap, map, tap } from 'rxjs/operators';
import { Observable, from, forkJoin } from 'rxjs';
import { NgxDhis2HttpClientService } from '@hisptz/ngx-dhis2-http-client';
import { DictionaryActionTypes, AddDictionaryMetadataListAction, UpdateDictionaryMetadataAction } from '../actions/dictionary.actions';
import { getDictionaryList } from '../selectors/dictionary.selectors';
var DictionaryEffects = /** @class */ (function () {
    function DictionaryEffects(actions$, store, httpClient, datePipe) {
        var _this = this;
        this.actions$ = actions$;
        this.store = store;
        this.httpClient = httpClient;
        this.datePipe = datePipe;
        this.initializeDictionary$ = this.actions$.pipe(ofType(DictionaryActionTypes.InitializeDictionaryMetadata), mergeMap(function (action) {
            return _this.store
                .select(getDictionaryList(action.dictionaryMetadataIdentifiers))
                .pipe(map(function (dictionaryList) {
                return _.filter(action.dictionaryMetadataIdentifiers, function (metadataId) { return !_.find(dictionaryList, ['id', metadataId]); });
            }));
        }), tap(function (identifiers) {
            /**
                   * Add incoming items to the dictionary list
                   */
            /**
             * Add incoming items to the dictionary list
             */
            _this.store.dispatch(new AddDictionaryMetadataListAction(_.map(identifiers, function (id) {
                return {
                    id: id,
                    name: '',
                    description: '',
                    progress: {
                        loading: true,
                        loadingSucceeded: false,
                        loadingFailed: false
                    }
                };
            })));
            /**
                   * Identify corresponding dictionary items
                   */
            from(identifiers)
                .pipe(mergeMap(function (identifier) {
                return _this.httpClient.get("identifiableObjects/" + identifier + ".json", true);
            }))
                .subscribe(function (metadata) {
                _this.store.dispatch(new UpdateDictionaryMetadataAction(metadata.id, {
                    name: metadata.name,
                    progress: {
                        loading: true,
                        loadingSucceeded: true,
                        loadingFailed: false
                    }
                }));
                if (metadata.href && metadata.href.indexOf('indicator') !== -1) {
                    var /** @type {?} */ indicatorUrl = 'indicators/' +
                        metadata.id +
                        '.json?fields=:all,displayName,id,name,numeratorDescription,' +
                        'denominatorDescription,denominator,numerator,annualized,decimals,indicatorType[name],user[name],' +
                        'attributeValues[value,attribute[name]],indicatorGroups[name,indicators~size],legendSet[name,symbolizer,' +
                        'legends~size],dataSets[name]';
                    _this.getIndicatorInfo(indicatorUrl, metadata.id);
                }
                else if (metadata.href &&
                    metadata.href.indexOf('dataElement') !== -1) {
                    var /** @type {?} */ dataElementUrl = 'dataElements/' +
                        metadata.id +
                        '.json?fields=:all,id,name,aggregationType,displayName,' +
                        'categoryCombo[id,name,categories[id,name,categoryOptions[id,name]]],dataSets[:all,!compulsoryDataElementOperands]';
                    _this.getDataElementInfo(dataElementUrl, metadata.id);
                }
                else if (metadata.href && metadata.href.indexOf('dataSet') !== -1) {
                    var /** @type {?} */ dataSetUrl = 'dataSets/' +
                        metadata.id +
                        '.json?fields=:all,user[:all],id,name,periodType,shortName,' +
                        'categoryCombo[id,name,categories[id,name,categoryOptions[id,name]]]';
                    _this.getDataSetInfo(dataSetUrl, metadata.id);
                }
            });
        }));
    }
    /**
     * @param {?} dataSetUrl
     * @param {?} dataSetId
     * @return {?}
     */
    DictionaryEffects.prototype.getDataSetInfo = /**
     * @param {?} dataSetUrl
     * @param {?} dataSetId
     * @return {?}
     */
    function (dataSetUrl, dataSetId) {
        var _this = this;
        this.httpClient.get("" + dataSetUrl, true).subscribe(function (dataSet) {
            var /** @type {?} */ dataSetDescription = '<p>' +
                dataSet.name +
                ' of the <strong>' +
                dataSet.formType +
                '</strong> Form created ' +
                'at <strong>' +
                _this.datePipe.transform(dataSet.created) +
                ' by ' +
                dataSet.user.name +
                '</strong>';
            if (dataSet.categoryCombo && dataSet.categoryCombo.name !== 'default') {
                dataSetDescription +=
                    '<span> With <strong>' +
                        dataSet.categoryCombo.name +
                        '</strong> Dimension which is divided' +
                        ' into ';
                dataSet.categoryCombo.categories.forEach(function (category, categoryIndex) {
                    if (categoryIndex !== 0 &&
                        categoryIndex !== dataSet.categoryCombo.categories.length - 1) {
                        dataSetDescription += ', ';
                    }
                    if (categoryIndex === dataSet.categoryCombo.categories.length - 1 &&
                        dataSet.categoryCombo.categories.length > 1) {
                        dataSetDescription += ' and ';
                    }
                    dataSetDescription += '<strong>';
                    category.categoryOptions.forEach(function (categoryOption, categoryOptionIndex) {
                        if (categoryOptionIndex !== 0 &&
                            categoryOptionIndex !== category.categoryOptions.length - 1) {
                            dataSetDescription += ', ';
                        }
                        if (categoryOptionIndex === category.categoryOptions.length - 1 &&
                            category.categoryOptions.length > 1) {
                            dataSetDescription += ' and ';
                        }
                        dataSetDescription += '<span>' + categoryOption.name + '</span>';
                    });
                    dataSetDescription += '</strong>';
                });
                dataSetDescription += '</span>';
            }
            dataSetDescription += '</p>';
            _this.store.dispatch(new UpdateDictionaryMetadataAction(dataSetId, {
                description: dataSetDescription,
                progress: {
                    loading: false,
                    loadingSucceeded: true,
                    loadingFailed: false
                }
            }));
        });
    };
    /**
     * @param {?} dataElementUrl
     * @param {?} dataElementId
     * @return {?}
     */
    DictionaryEffects.prototype.getDataElementInfo = /**
     * @param {?} dataElementUrl
     * @param {?} dataElementId
     * @return {?}
     */
    function (dataElementUrl, dataElementId) {
        var _this = this;
        this.httpClient
            .get("" + dataElementUrl, true)
            .subscribe(function (dataElement) {
            var /** @type {?} */ dataElementDescription = '<p>This ' +
                dataElement.name +
                ' of this method of data aggregation <strong>' +
                dataElement.aggregationType +
                '</strong> created at <strong>' +
                _this.datePipe.transform(dataElement.created) +
                '</strong> is only taking <strong>' +
                dataElement.domainType +
                '</strong> data. As the culture of helping user ' +
                'not entering unrecognized data, therefore its only taking <strong>' +
                dataElement.valueType +
                '</strong> values ' +
                'from the user input</p>';
            if (dataElement.categoryCombo.name !== 'default') {
                dataElementDescription +=
                    '<p><strong>' +
                        dataElement.name +
                        '</strong> consists of <strong>' +
                        dataElement.categoryCombo.name +
                        '</strong> category combinations of ';
                dataElement.categoryCombo.categories.forEach(function (category, index) {
                    if (index !== 0 &&
                        index !== dataElement.categoryCombo.categories.length - 1) {
                        dataElementDescription += ', ';
                    }
                    if (index === dataElement.categoryCombo.categories.length - 1 &&
                        dataElement.categoryCombo.categories.length > 1) {
                        dataElementDescription += ' and ';
                    }
                    dataElementDescription += '<strong>(';
                    category.categoryOptions.forEach(function (categoryOption, categoryOptionIndex) {
                        if (categoryOptionIndex !== 0 &&
                            categoryOptionIndex !== category.categoryOptions.length - 1) {
                            dataElementDescription += ', ';
                        }
                        if (categoryOptionIndex === category.categoryOptions.length - 1 &&
                            category.categoryOptions.length > 1) {
                            dataElementDescription += ' and ';
                        }
                        dataElementDescription +=
                            '<span>' + categoryOption.name + '</span>';
                    });
                    dataElementDescription +=
                        ')</strong> of the <strong>' +
                            category.name +
                            '</strong> category';
                });
                dataElementDescription += '</strong></p>';
                // TODO deal with different version of dhis
                if (dataElement.dataSets && dataElement.dataSets.length > 0) {
                    dataElementDescription +=
                        '<h5>' + dataElement.name + ' Sources</h5>';
                    dataElementDescription +=
                        '<p>More than <strong>' +
                            dataElement.dataSets.length +
                            '</strong> dataset ie ';
                    dataElement.dataSets.forEach(function (dataSet, dataSetIndex) {
                        if (dataSetIndex !== 0 &&
                            dataSetIndex !== dataElement.dataSets.length - 1) {
                            dataElementDescription += ', ';
                        }
                        if (dataSetIndex === dataElement.dataSets.length - 1 &&
                            dataElement.dataSets.length > 1) {
                            dataElementDescription += ' and ';
                        }
                        dataElementDescription +=
                            '<strong>' + dataSet.name + '</strong>';
                    });
                    dataElementDescription +=
                        ' use this ' + dataElement.name + ' data element';
                    if (dataElement.dataElementGroups &&
                        dataElement.dataElementGroups.length > 0) {
                        dataElementDescription += ' and it belongs to ';
                        dataElement.dataElementGroups.forEach(function (dataElementGroup, dataElementGroupIndex) {
                            if (dataElementGroupIndex !== 0 &&
                                dataElementGroupIndex !==
                                    dataElement.dataElementGroups.length - 1) {
                                dataElementDescription += ', ';
                            }
                            if (dataElementGroupIndex ===
                                dataElement.dataElementGroups.length - 1 &&
                                dataElement.dataElementGroups.length > 1) {
                                dataElementDescription += ' and ';
                            }
                            dataElementDescription +=
                                '<strong>' + dataElementGroup.name + ' Group</strong>';
                        });
                    }
                    dataElementDescription += '</p>';
                }
                _this.store.dispatch(new UpdateDictionaryMetadataAction(dataElementId, {
                    description: dataElementDescription,
                    progress: {
                        loading: false,
                        loadingSucceeded: true,
                        loadingFailed: false
                    }
                }));
            }
        });
    };
    /**
     * @param {?} indicatorUrl
     * @param {?} indicatorId
     * @return {?}
     */
    DictionaryEffects.prototype.getIndicatorInfo = /**
     * @param {?} indicatorUrl
     * @param {?} indicatorId
     * @return {?}
     */
    function (indicatorUrl, indicatorId) {
        var _this = this;
        this.httpClient.get("" + indicatorUrl, true).subscribe(function (indicator) {
            var /** @type {?} */ indicatorDescription = '<p><strong>' +
                indicator.name +
                '</strong> is a <strong>' +
                indicator.indicatorType.name +
                ' </strong> indicator';
            if (indicator.numeratorDescription) {
                indicatorDescription +=
                    '<span> with the numerator described as <strong>' +
                        indicator.numeratorDescription +
                        '</strong></span>';
            }
            if (indicator.denominatorDescription) {
                indicatorDescription +=
                    '<span> and denominator described as <strong>' +
                        indicator.denominatorDescription +
                        '</strong></span>';
            }
            indicatorDescription += '</p>';
            if (indicator.annualized) {
                indicatorDescription +=
                    '<p><span>Itâ€™s figure is annualized to support analysis in less than year period ' +
                        '(monthly,quarterly,semi-annually)</span></p>';
            }
            _this.store.dispatch(new UpdateDictionaryMetadataAction(indicatorId, {
                description: indicatorDescription,
                progress: {
                    loading: true,
                    loadingSucceeded: true,
                    loadingFailed: false
                }
            }));
            /**
                   * Get numerator expression
                   */
            forkJoin(_this.httpClient.get('expressions/description?expression=' +
                encodeURIComponent(indicator.numerator), true), _this.httpClient.get('dataSets.json?fields=periodType,id,name,timelyDays,formType,created,expiryDays&' +
                'filter=dataSetElements.dataElement.id:in:[' +
                _this.getAvailableDataElements(indicator.numerator) +
                ']&paging=false', true)).subscribe(function (numeratorResults) {
                if (numeratorResults[0]) {
                    indicatorDescription +=
                        '<p>Numerator is calculated from <strong>' +
                            numeratorResults[0].description +
                            '</strong>';
                }
                if (numeratorResults[1] && numeratorResults[1].dataSets) {
                    var /** @type {?} */ dataSets_1 = numeratorResults[1].dataSets;
                    if (dataSets_1.length > 0) {
                        indicatorDescription += ' originating from ';
                    }
                    dataSets_1.forEach(function (dataset, index) {
                        if (index !== 0 && index !== dataSets_1.length - 1) {
                            indicatorDescription += ', ';
                        }
                        if (index === dataSets_1.length - 1 && dataSets_1.length > 1) {
                            indicatorDescription += ' and ';
                        }
                        indicatorDescription +=
                            '<span><strong>' +
                                dataset.name +
                                ',</strong> that is collected <strong>' +
                                dataset.periodType +
                                '</strong> with deadline for submission after <strong>' +
                                dataset.timelyDays +
                                ' days </strong></span>';
                    });
                }
                indicatorDescription += "</p>";
                _this.store.dispatch(new UpdateDictionaryMetadataAction(indicatorId, {
                    description: indicatorDescription,
                    progress: {
                        loading: true,
                        loadingSucceeded: true,
                        loadingFailed: false
                    }
                }));
                /**
                         * Get denominator expression
                         */
                forkJoin(_this.httpClient.get('expressions/description?expression=' +
                    encodeURIComponent(indicator.denominator), true), _this.httpClient.get('dataSets.json?fields=periodType,id,name,timelyDays,formType,created,expiryDays&' +
                    'filter=dataSetElements.dataElement.id:in:[' +
                    _this.getAvailableDataElements(indicator.denominator) +
                    ']&paging=false', true)).subscribe(function (denominatorResults) {
                    if (denominatorResults[0]) {
                        indicatorDescription +=
                            '<p>Denominator is calculated from <strong>' +
                                denominatorResults[0].description +
                                '</strong>';
                    }
                    if (denominatorResults[1] && denominatorResults[1].dataSets) {
                        var /** @type {?} */ dataSets_2 = denominatorResults[1].dataSets;
                        if (dataSets_2.length > 0) {
                            indicatorDescription += ' originating from ';
                        }
                        dataSets_2.forEach(function (dataset, index) {
                            if (index !== 0 && index !== dataSets_2.length - 1) {
                                indicatorDescription += ', ';
                            }
                            if (index === dataSets_2.length - 1 && dataSets_2.length > 1) {
                                indicatorDescription += ' and ';
                            }
                            indicatorDescription +=
                                '<span><strong>' +
                                    dataset.name +
                                    ',</strong> that is collected <strong>' +
                                    dataset.periodType +
                                    '</strong> with deadline for submission after <strong>' +
                                    dataset.timelyDays +
                                    ' days </strong></span>';
                        });
                    }
                    indicatorDescription += "</p>";
                    /**
                               * Indicator group
                               */
                    if (indicator.indicatorGroups &&
                        indicator.indicatorGroups.length > 0) {
                        indicatorDescription += '<div><p>It belongs to ';
                        indicator.indicatorGroups.forEach(function (indicatorGroup, index) {
                            if (index !== 0 &&
                                index !== indicator.indicatorGroups.length - 1) {
                                indicatorDescription += ', ';
                            }
                            if (index === indicator.indicatorGroups.length - 1 &&
                                indicator.indicatorGroups.length > 1) {
                                indicatorDescription += ' and ';
                            }
                            indicatorDescription +=
                                '<span><strong>' +
                                    indicatorGroup.name +
                                    '</strong> with <strong>' +
                                    indicatorGroup.indicators +
                                    '</strong> other related indicators</span>';
                        });
                        indicatorDescription += '</p></div>';
                    }
                    /**
                               * Attribute values
                               */
                    if (indicator.attributeValues &&
                        indicator.attributeValues.length > 0) {
                        indicatorDescription +=
                            '<div><p>Other related details associated with this indicators includes: ';
                        indicator.attributeValues.forEach(function (attr) {
                            indicatorDescription +=
                                '<span><strong>' +
                                    attr.attribute.name +
                                    ': ' +
                                    attr.value +
                                    '</strong></span>';
                        });
                        indicatorDescription += '</p></div>';
                    }
                    /**
                               * Legend set
                               */
                    if (indicator.legendSet) {
                        indicatorDescription +=
                            '<div><p> It makes use of: <strong>' +
                                indicator.legendSet.name +
                                '</strong> legend' +
                                ' set for analysis with <strong>' +
                                indicator.legendSet.legends +
                                ' Classes </strong>using <strong>' +
                                indicator.legendSet.symbolizer +
                                ' for analysis</strong></p></div>';
                    }
                    /**
                               * User info
                               */
                    if (indicator.user) {
                        indicatorDescription +=
                            '<div><p>This indicator was <strong> first created </strong> in the system on <strong>' +
                                _this.datePipe.transform(indicator.created) +
                                '</strong> by <strong>' +
                                indicator.user.name +
                                '</strong></p></div>';
                    }
                    _this.store.dispatch(new UpdateDictionaryMetadataAction(indicatorId, {
                        description: indicatorDescription,
                        progress: {
                            loading: false,
                            loadingSucceeded: true,
                            loadingFailed: false
                        }
                    }));
                });
            });
        });
    };
    /**
     * @param {?} data
     * @return {?}
     */
    DictionaryEffects.prototype.getAvailableDataElements = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        var /** @type {?} */ dataElementUids = [];
        var /** @type {?} */ separators = [' ', '\\+', '-', '\\(', '\\)', '\\*', '/', ':', '\\?'];
        var /** @type {?} */ numeratorDataElements = data.split(new RegExp(separators.join('|'), 'g'));
        numeratorDataElements.forEach(function (dataElement) {
            dataElementUids = _this.dataElementWithCategoryOptionCheck(dataElement);
        });
        return dataElementUids.join();
    };
    /**
     * @param {?} dataElement
     * @return {?}
     */
    DictionaryEffects.prototype.dataElementWithCategoryOptionCheck = /**
     * @param {?} dataElement
     * @return {?}
     */
    function (dataElement) {
        var /** @type {?} */ uid = [];
        if (dataElement.indexOf('.') >= 1) {
            uid.push(dataElement
                .replace(/#/g, '')
                .replace(/{/g, '')
                .replace(/}/g, '')
                .split('.')[0]);
        }
        else {
            uid.push(dataElement
                .replace(/#/g, '')
                .replace(/{/g, '')
                .replace(/}/g, ''));
        }
        return uid;
    };
    DictionaryEffects.decorators = [
        { type: Injectable },
    ];
    /** @nocollapse */
    DictionaryEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: Store },
        { type: NgxDhis2HttpClientService },
        { type: DatePipe }
    ]; };
    tslib_1.__decorate([
        Effect({ dispatch: false }),
        tslib_1.__metadata("design:type", Observable)
    ], DictionaryEffects.prototype, "initializeDictionary$", void 0);
    return DictionaryEffects;
}());
export { DictionaryEffects };
function DictionaryEffects_tsickle_Closure_declarations() {
    /** @type {?} */
    DictionaryEffects.prototype.initializeDictionary$;
    /** @type {?} */
    DictionaryEffects.prototype.actions$;
    /** @type {?} */
    DictionaryEffects.prototype.store;
    /** @type {?} */
    DictionaryEffects.prototype.httpClient;
    /** @type {?} */
    DictionaryEffects.prototype.datePipe;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGljdGlvbmFyeS5lZmZlY3RzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGhpc3B0ei9uZ3gtZGhpczItZGljdGlvbmFyeS8iLCJzb3VyY2VzIjpbImxpYi9zdG9yZS9lZmZlY3RzL2RpY3Rpb25hcnkuZWZmZWN0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDcEMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXhELE9BQU8sS0FBSyxDQUFDLE1BQU0sUUFBUSxDQUFDO0FBQzVCLE9BQU8sRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUVsRCxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUcxRSxPQUFPLEVBQ0wscUJBQXFCLEVBRXJCLCtCQUErQixFQUMvQiw4QkFBOEIsRUFDL0IsTUFBTSwrQkFBK0IsQ0FBQztBQUN2QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQzs7SUFJcEUsMkJBQ1UsVUFDQSxPQUNBLFlBQ0E7UUFKVixpQkFLSTtRQUpNLGFBQVEsR0FBUixRQUFRO1FBQ1IsVUFBSyxHQUFMLEtBQUs7UUFDTCxlQUFVLEdBQVYsVUFBVTtRQUNWLGFBQVEsR0FBUixRQUFRO3FDQUl1QixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDekQsTUFBTSxDQUFDLHFCQUFxQixDQUFDLDRCQUE0QixDQUFDLEVBQzFELFFBQVEsQ0FBQyxVQUFDLE1BQTBD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QUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQztpQkFDakIsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUM7aUJBQ2pCLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDO2lCQUNqQixLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ2pCLENBQUM7U0FDSDtRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sR0FBRyxDQUFDLElBQUksQ0FDTixXQUFXO2lCQUNSLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDO2lCQUNqQixPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQztpQkFDakIsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FDckIsQ0FBQztTQUNIO1FBRUQsTUFBTSxDQUFDLEdBQUcsQ0FBQztLQUNaOztnQkF6bUJGLFVBQVU7Ozs7Z0JBakJGLE9BQU87Z0JBRFAsS0FBSztnQkFPTCx5QkFBeUI7Z0JBUnpCLFFBQVE7OztRQTRCZCxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLENBQUM7MENBQ0wsVUFBVTs7NEJBOUJuQzs7U0FxQmEsaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRGF0ZVBpcGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgU3RvcmUgfSBmcm9tICdAbmdyeC9zdG9yZSc7XG5pbXBvcnQgeyBBY3Rpb25zLCBFZmZlY3QsIG9mVHlwZSB9IGZyb20gJ0BuZ3J4L2VmZmVjdHMnO1xuXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBtZXJnZU1hcCwgbWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBmcm9tLCBmb3JrSm9pbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBOZ3hEaGlzMkh0dHBDbGllbnRTZXJ2aWNlIH0gZnJvbSAnQGhpc3B0ei9uZ3gtZGhpczItaHR0cC1jbGllbnQnO1xuaW1wb3J0IHsgRGljdGlvbmFyeVN0YXRlIH0gZnJvbSAnLi4vcmVkdWNlcnMvZGljdGlvbmFyeS5yZWR1Y2VyJztcblxuaW1wb3J0IHtcbiAgRGljdGlvbmFyeUFjdGlvblR5cGVzLFxuICBJbml0aWFsaXplRGljdGlvbmFyeU1ldGFkYXRhQWN0aW9uLFxuICBBZGREaWN0aW9uYXJ5TWV0YWRhdGFMaXN0QWN0aW9uLFxuICBVcGRhdGVEaWN0aW9uYXJ5TWV0YWRhdGFBY3Rpb25cbn0gZnJvbSAnLi4vYWN0aW9ucy9kaWN0aW9uYXJ5LmFjdGlvbnMnO1xuaW1wb3J0IHsgZ2V0RGljdGlvbmFyeUxpc3QgfSBmcm9tICcuLi9zZWxlY3RvcnMvZGljdGlvbmFyeS5zZWxlY3RvcnMnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGljdGlvbmFyeUVmZmVjdHMge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGFjdGlvbnMkOiBBY3Rpb25zLFxuICAgIHByaXZhdGUgc3RvcmU6IFN0b3JlPERpY3Rpb25hcnlTdGF0ZT4sXG4gICAgcHJpdmF0ZSBodHRwQ2xpZW50OiBOZ3hEaGlzMkh0dHBDbGllbnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgZGF0ZVBpcGU6IERhdGVQaXBlXG4gICkge31cblxuICBARWZmZWN0KHsgZGlzcGF0Y2g6IGZhbHNlIH0pXG4gIGluaXRpYWxpemVEaWN0aW9uYXJ5JDogT2JzZXJ2YWJsZTxhbnk+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShEaWN0aW9uYXJ5QWN0aW9uVHlwZXMuSW5pdGlhbGl6ZURpY3Rpb25hcnlNZXRhZGF0YSksXG4gICAgbWVyZ2VNYXAoKGFjdGlvbjogSW5pdGlhbGl6ZURpY3Rpb25hcnlNZXRhZGF0YUFjdGlvbikgPT5cbiAgICAgIHRoaXMuc3RvcmVcbiAgICAgICAgLnNlbGVjdChnZXREaWN0aW9uYXJ5TGlzdChhY3Rpb24uZGljdGlvbmFyeU1ldGFkYXRhSWRlbnRpZmllcnMpKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBtYXAoKGRpY3Rpb25hcnlMaXN0OiBhbnlbXSkgPT5cbiAgICAgICAgICAgIF8uZmlsdGVyKFxuICAgICAgICAgICAgICBhY3Rpb24uZGljdGlvbmFyeU1ldGFkYXRhSWRlbnRpZmllcnMsXG4gICAgICAgICAgICAgIG1ldGFkYXRhSWQgPT4gIV8uZmluZChkaWN0aW9uYXJ5TGlzdCwgWydpZCcsIG1ldGFkYXRhSWRdKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICksXG4gICAgdGFwKGlkZW50aWZpZXJzID0+IHtcbiAgICAgIC8qKlxuICAgICAgICogQWRkIGluY29taW5nIGl0ZW1zIHRvIHRoZSBkaWN0aW9uYXJ5IGxpc3RcbiAgICAgICAqL1xuICAgICAgdGhpcy5zdG9yZS5kaXNwYXRjaChcbiAgICAgICAgbmV3IEFkZERpY3Rpb25hcnlNZXRhZGF0YUxpc3RBY3Rpb24oXG4gICAgICAgICAgXy5tYXAoaWRlbnRpZmllcnMsIGlkID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICcnLFxuICAgICAgICAgICAgICBwcm9ncmVzczoge1xuICAgICAgICAgICAgICAgIGxvYWRpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgbG9hZGluZ1N1Y2NlZWRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgbG9hZGluZ0ZhaWxlZDogZmFsc2VcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApO1xuICAgICAgLyoqXG4gICAgICAgKiBJZGVudGlmeSBjb3JyZXNwb25kaW5nIGRpY3Rpb25hcnkgaXRlbXNcbiAgICAgICAqL1xuICAgICAgZnJvbShpZGVudGlmaWVycylcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgbWVyZ2VNYXAoaWRlbnRpZmllciA9PlxuICAgICAgICAgICAgdGhpcy5odHRwQ2xpZW50LmdldChgaWRlbnRpZmlhYmxlT2JqZWN0cy8ke2lkZW50aWZpZXJ9Lmpzb25gLCB0cnVlKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKChtZXRhZGF0YTogYW55KSA9PiB7XG4gICAgICAgICAgdGhpcy5zdG9yZS5kaXNwYXRjaChcbiAgICAgICAgICAgIG5ldyBVcGRhdGVEaWN0aW9uYXJ5TWV0YWRhdGFBY3Rpb24obWV0YWRhdGEuaWQsIHtcbiAgICAgICAgICAgICAgbmFtZTogbWV0YWRhdGEubmFtZSxcbiAgICAgICAgICAgICAgcHJvZ3Jlc3M6IHtcbiAgICAgICAgICAgICAgICBsb2FkaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxvYWRpbmdTdWNjZWVkZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgbG9hZGluZ0ZhaWxlZDogZmFsc2VcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKG1ldGFkYXRhLmhyZWYgJiYgbWV0YWRhdGEuaHJlZi5pbmRleE9mKCdpbmRpY2F0b3InKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGNvbnN0IGluZGljYXRvclVybCA9XG4gICAgICAgICAgICAgICdpbmRpY2F0b3JzLycgK1xuICAgICAgICAgICAgICBtZXRhZGF0YS5pZCArXG4gICAgICAgICAgICAgICcuanNvbj9maWVsZHM9OmFsbCxkaXNwbGF5TmFtZSxpZCxuYW1lLG51bWVyYXRvckRlc2NyaXB0aW9uLCcgK1xuICAgICAgICAgICAgICAnZGVub21pbmF0b3JEZXNjcmlwdGlvbixkZW5vbWluYXRvcixudW1lcmF0b3IsYW5udWFsaXplZCxkZWNpbWFscyxpbmRpY2F0b3JUeXBlW25hbWVdLHVzZXJbbmFtZV0sJyArXG4gICAgICAgICAgICAgICdhdHRyaWJ1dGVWYWx1ZXNbdmFsdWUsYXR0cmlidXRlW25hbWVdXSxpbmRpY2F0b3JHcm91cHNbbmFtZSxpbmRpY2F0b3JzfnNpemVdLGxlZ2VuZFNldFtuYW1lLHN5bWJvbGl6ZXIsJyArXG4gICAgICAgICAgICAgICdsZWdlbmRzfnNpemVdLGRhdGFTZXRzW25hbWVdJztcbiAgICAgICAgICAgIHRoaXMuZ2V0SW5kaWNhdG9ySW5mbyhpbmRpY2F0b3JVcmwsIG1ldGFkYXRhLmlkKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgbWV0YWRhdGEuaHJlZiAmJlxuICAgICAgICAgICAgbWV0YWRhdGEuaHJlZi5pbmRleE9mKCdkYXRhRWxlbWVudCcpICE9PSAtMVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgY29uc3QgZGF0YUVsZW1lbnRVcmwgPVxuICAgICAgICAgICAgICAnZGF0YUVsZW1lbnRzLycgK1xuICAgICAgICAgICAgICBtZXRhZGF0YS5pZCArXG4gICAgICAgICAgICAgICcuanNvbj9maWVsZHM9OmFsbCxpZCxuYW1lLGFnZ3JlZ2F0aW9uVHlwZSxkaXNwbGF5TmFtZSwnICtcbiAgICAgICAgICAgICAgJ2NhdGVnb3J5Q29tYm9baWQsbmFtZSxjYXRlZ29yaWVzW2lkLG5hbWUsY2F0ZWdvcnlPcHRpb25zW2lkLG5hbWVdXV0sZGF0YVNldHNbOmFsbCwhY29tcHVsc29yeURhdGFFbGVtZW50T3BlcmFuZHNdJztcbiAgICAgICAgICAgIHRoaXMuZ2V0RGF0YUVsZW1lbnRJbmZvKGRhdGFFbGVtZW50VXJsLCBtZXRhZGF0YS5pZCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChtZXRhZGF0YS5ocmVmICYmIG1ldGFkYXRhLmhyZWYuaW5kZXhPZignZGF0YVNldCcpICE9PSAtMSkge1xuICAgICAgICAgICAgY29uc3QgZGF0YVNldFVybCA9XG4gICAgICAgICAgICAgICdkYXRhU2V0cy8nICtcbiAgICAgICAgICAgICAgbWV0YWRhdGEuaWQgK1xuICAgICAgICAgICAgICAnLmpzb24/ZmllbGRzPTphbGwsdXNlcls6YWxsXSxpZCxuYW1lLHBlcmlvZFR5cGUsc2hvcnROYW1lLCcgK1xuICAgICAgICAgICAgICAnY2F0ZWdvcnlDb21ib1tpZCxuYW1lLGNhdGVnb3JpZXNbaWQsbmFtZSxjYXRlZ29yeU9wdGlvbnNbaWQsbmFtZV1dXSc7XG4gICAgICAgICAgICB0aGlzLmdldERhdGFTZXRJbmZvKGRhdGFTZXRVcmwsIG1ldGFkYXRhLmlkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pXG4gICk7XG5cbiAgZ2V0RGF0YVNldEluZm8oZGF0YVNldFVybDogc3RyaW5nLCBkYXRhU2V0SWQ6IHN0cmluZykge1xuICAgIHRoaXMuaHR0cENsaWVudC5nZXQoYCR7ZGF0YVNldFVybH1gLCB0cnVlKS5zdWJzY3JpYmUoKGRhdGFTZXQ6IGFueSkgPT4ge1xuICAgICAgbGV0IGRhdGFTZXREZXNjcmlwdGlvbiA9XG4gICAgICAgICc8cD4nICtcbiAgICAgICAgZGF0YVNldC5uYW1lICtcbiAgICAgICAgJyBvZiB0aGUgPHN0cm9uZz4nICtcbiAgICAgICAgZGF0YVNldC5mb3JtVHlwZSArXG4gICAgICAgICc8L3N0cm9uZz4gRm9ybSBjcmVhdGVkICcgK1xuICAgICAgICAnYXQgPHN0cm9uZz4nICtcbiAgICAgICAgdGhpcy5kYXRlUGlwZS50cmFuc2Zvcm0oZGF0YVNldC5jcmVhdGVkKSArXG4gICAgICAgICcgYnkgJyArXG4gICAgICAgIGRhdGFTZXQudXNlci5uYW1lICtcbiAgICAgICAgJzwvc3Ryb25nPic7XG5cbiAgICAgIGlmIChkYXRhU2V0LmNhdGVnb3J5Q29tYm8gJiYgZGF0YVNldC5jYXRlZ29yeUNvbWJvLm5hbWUgIT09ICdkZWZhdWx0Jykge1xuICAgICAgICBkYXRhU2V0RGVzY3JpcHRpb24gKz1cbiAgICAgICAgICAnPHNwYW4+IFdpdGggPHN0cm9uZz4nICtcbiAgICAgICAgICBkYXRhU2V0LmNhdGVnb3J5Q29tYm8ubmFtZSArXG4gICAgICAgICAgJzwvc3Ryb25nPiBEaW1lbnNpb24gd2hpY2ggaXMgZGl2aWRlZCcgK1xuICAgICAgICAgICcgaW50byAnO1xuXG4gICAgICAgIGRhdGFTZXQuY2F0ZWdvcnlDb21iby5jYXRlZ29yaWVzLmZvckVhY2goKGNhdGVnb3J5LCBjYXRlZ29yeUluZGV4KSA9PiB7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgY2F0ZWdvcnlJbmRleCAhPT0gMCAmJlxuICAgICAgICAgICAgY2F0ZWdvcnlJbmRleCAhPT0gZGF0YVNldC5jYXRlZ29yeUNvbWJvLmNhdGVnb3JpZXMubGVuZ3RoIC0gMVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgZGF0YVNldERlc2NyaXB0aW9uICs9ICcsICc7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgY2F0ZWdvcnlJbmRleCA9PT0gZGF0YVNldC5jYXRlZ29yeUNvbWJvLmNhdGVnb3JpZXMubGVuZ3RoIC0gMSAmJlxuICAgICAgICAgICAgZGF0YVNldC5jYXRlZ29yeUNvbWJvLmNhdGVnb3JpZXMubGVuZ3RoID4gMVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgZGF0YVNldERlc2NyaXB0aW9uICs9ICcgYW5kICc7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZGF0YVNldERlc2NyaXB0aW9uICs9ICc8c3Ryb25nPic7XG5cbiAgICAgICAgICBjYXRlZ29yeS5jYXRlZ29yeU9wdGlvbnMuZm9yRWFjaChcbiAgICAgICAgICAgIChjYXRlZ29yeU9wdGlvbiwgY2F0ZWdvcnlPcHRpb25JbmRleCkgPT4ge1xuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnlPcHRpb25JbmRleCAhPT0gMCAmJlxuICAgICAgICAgICAgICAgIGNhdGVnb3J5T3B0aW9uSW5kZXggIT09IGNhdGVnb3J5LmNhdGVnb3J5T3B0aW9ucy5sZW5ndGggLSAxXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGRhdGFTZXREZXNjcmlwdGlvbiArPSAnLCAnO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGNhdGVnb3J5T3B0aW9uSW5kZXggPT09IGNhdGVnb3J5LmNhdGVnb3J5T3B0aW9ucy5sZW5ndGggLSAxICYmXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnkuY2F0ZWdvcnlPcHRpb25zLmxlbmd0aCA+IDFcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgZGF0YVNldERlc2NyaXB0aW9uICs9ICcgYW5kICc7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBkYXRhU2V0RGVzY3JpcHRpb24gKz0gJzxzcGFuPicgKyBjYXRlZ29yeU9wdGlvbi5uYW1lICsgJzwvc3Bhbj4nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBkYXRhU2V0RGVzY3JpcHRpb24gKz0gJzwvc3Ryb25nPic7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRhdGFTZXREZXNjcmlwdGlvbiArPSAnPC9zcGFuPic7XG4gICAgICB9XG5cbiAgICAgIGRhdGFTZXREZXNjcmlwdGlvbiArPSAnPC9wPic7XG5cbiAgICAgIHRoaXMuc3RvcmUuZGlzcGF0Y2goXG4gICAgICAgIG5ldyBVcGRhdGVEaWN0aW9uYXJ5TWV0YWRhdGFBY3Rpb24oZGF0YVNldElkLCB7XG4gICAgICAgICAgZGVzY3JpcHRpb246IGRhdGFTZXREZXNjcmlwdGlvbixcbiAgICAgICAgICBwcm9ncmVzczoge1xuICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICBsb2FkaW5nU3VjY2VlZGVkOiB0cnVlLFxuICAgICAgICAgICAgbG9hZGluZ0ZhaWxlZDogZmFsc2VcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0RGF0YUVsZW1lbnRJbmZvKGRhdGFFbGVtZW50VXJsOiBzdHJpbmcsIGRhdGFFbGVtZW50SWQ6IHN0cmluZykge1xuICAgIHRoaXMuaHR0cENsaWVudFxuICAgICAgLmdldChgJHtkYXRhRWxlbWVudFVybH1gLCB0cnVlKVxuICAgICAgLnN1YnNjcmliZSgoZGF0YUVsZW1lbnQ6IGFueSkgPT4ge1xuICAgICAgICBsZXQgZGF0YUVsZW1lbnREZXNjcmlwdGlvbiA9XG4gICAgICAgICAgJzxwPlRoaXMgJyArXG4gICAgICAgICAgZGF0YUVsZW1lbnQubmFtZSArXG4gICAgICAgICAgJyBvZiB0aGlzIG1ldGhvZCBvZiBkYXRhIGFnZ3JlZ2F0aW9uIDxzdHJvbmc+JyArXG4gICAgICAgICAgZGF0YUVsZW1lbnQuYWdncmVnYXRpb25UeXBlICtcbiAgICAgICAgICAnPC9zdHJvbmc+IGNyZWF0ZWQgYXQgPHN0cm9uZz4nICtcbiAgICAgICAgICB0aGlzLmRhdGVQaXBlLnRyYW5zZm9ybShkYXRhRWxlbWVudC5jcmVhdGVkKSArXG4gICAgICAgICAgJzwvc3Ryb25nPiBpcyBvbmx5IHRha2luZyA8c3Ryb25nPicgK1xuICAgICAgICAgIGRhdGFFbGVtZW50LmRvbWFpblR5cGUgK1xuICAgICAgICAgICc8L3N0cm9uZz4gZGF0YS4gQXMgdGhlIGN1bHR1cmUgb2YgaGVscGluZyB1c2VyICcgK1xuICAgICAgICAgICdub3QgZW50ZXJpbmcgdW5yZWNvZ25pemVkIGRhdGEsIHRoZXJlZm9yZSBpdHMgb25seSB0YWtpbmcgPHN0cm9uZz4nICtcbiAgICAgICAgICBkYXRhRWxlbWVudC52YWx1ZVR5cGUgK1xuICAgICAgICAgICc8L3N0cm9uZz4gdmFsdWVzICcgK1xuICAgICAgICAgICdmcm9tIHRoZSB1c2VyIGlucHV0PC9wPic7XG5cbiAgICAgICAgaWYgKGRhdGFFbGVtZW50LmNhdGVnb3J5Q29tYm8ubmFtZSAhPT0gJ2RlZmF1bHQnKSB7XG4gICAgICAgICAgZGF0YUVsZW1lbnREZXNjcmlwdGlvbiArPVxuICAgICAgICAgICAgJzxwPjxzdHJvbmc+JyArXG4gICAgICAgICAgICBkYXRhRWxlbWVudC5uYW1lICtcbiAgICAgICAgICAgICc8L3N0cm9uZz4gY29uc2lzdHMgb2YgPHN0cm9uZz4nICtcbiAgICAgICAgICAgIGRhdGFFbGVtZW50LmNhdGVnb3J5Q29tYm8ubmFtZSArXG4gICAgICAgICAgICAnPC9zdHJvbmc+IGNhdGVnb3J5IGNvbWJpbmF0aW9ucyBvZiAnO1xuXG4gICAgICAgICAgZGF0YUVsZW1lbnQuY2F0ZWdvcnlDb21iby5jYXRlZ29yaWVzLmZvckVhY2goKGNhdGVnb3J5LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBpbmRleCAhPT0gMCAmJlxuICAgICAgICAgICAgICBpbmRleCAhPT0gZGF0YUVsZW1lbnQuY2F0ZWdvcnlDb21iby5jYXRlZ29yaWVzLmxlbmd0aCAtIDFcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBkYXRhRWxlbWVudERlc2NyaXB0aW9uICs9ICcsICc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgaW5kZXggPT09IGRhdGFFbGVtZW50LmNhdGVnb3J5Q29tYm8uY2F0ZWdvcmllcy5sZW5ndGggLSAxICYmXG4gICAgICAgICAgICAgIGRhdGFFbGVtZW50LmNhdGVnb3J5Q29tYm8uY2F0ZWdvcmllcy5sZW5ndGggPiAxXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgZGF0YUVsZW1lbnREZXNjcmlwdGlvbiArPSAnIGFuZCAnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkYXRhRWxlbWVudERlc2NyaXB0aW9uICs9ICc8c3Ryb25nPignO1xuICAgICAgICAgICAgY2F0ZWdvcnkuY2F0ZWdvcnlPcHRpb25zLmZvckVhY2goXG4gICAgICAgICAgICAgIChjYXRlZ29yeU9wdGlvbiwgY2F0ZWdvcnlPcHRpb25JbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgIGNhdGVnb3J5T3B0aW9uSW5kZXggIT09IDAgJiZcbiAgICAgICAgICAgICAgICAgIGNhdGVnb3J5T3B0aW9uSW5kZXggIT09IGNhdGVnb3J5LmNhdGVnb3J5T3B0aW9ucy5sZW5ndGggLSAxXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICBkYXRhRWxlbWVudERlc2NyaXB0aW9uICs9ICcsICc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgY2F0ZWdvcnlPcHRpb25JbmRleCA9PT0gY2F0ZWdvcnkuY2F0ZWdvcnlPcHRpb25zLmxlbmd0aCAtIDEgJiZcbiAgICAgICAgICAgICAgICAgIGNhdGVnb3J5LmNhdGVnb3J5T3B0aW9ucy5sZW5ndGggPiAxXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICBkYXRhRWxlbWVudERlc2NyaXB0aW9uICs9ICcgYW5kICc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZGF0YUVsZW1lbnREZXNjcmlwdGlvbiArPVxuICAgICAgICAgICAgICAgICAgJzxzcGFuPicgKyBjYXRlZ29yeU9wdGlvbi5uYW1lICsgJzwvc3Bhbj4nO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBkYXRhRWxlbWVudERlc2NyaXB0aW9uICs9XG4gICAgICAgICAgICAgICcpPC9zdHJvbmc+IG9mIHRoZSA8c3Ryb25nPicgK1xuICAgICAgICAgICAgICBjYXRlZ29yeS5uYW1lICtcbiAgICAgICAgICAgICAgJzwvc3Ryb25nPiBjYXRlZ29yeSc7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBkYXRhRWxlbWVudERlc2NyaXB0aW9uICs9ICc8L3N0cm9uZz48L3A+JztcblxuICAgICAgICAgIC8vIFRPRE8gZGVhbCB3aXRoIGRpZmZlcmVudCB2ZXJzaW9uIG9mIGRoaXNcbiAgICAgICAgICBpZiAoZGF0YUVsZW1lbnQuZGF0YVNldHMgJiYgZGF0YUVsZW1lbnQuZGF0YVNldHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZGF0YUVsZW1lbnREZXNjcmlwdGlvbiArPVxuICAgICAgICAgICAgICAnPGg1PicgKyBkYXRhRWxlbWVudC5uYW1lICsgJyBTb3VyY2VzPC9oNT4nO1xuXG4gICAgICAgICAgICBkYXRhRWxlbWVudERlc2NyaXB0aW9uICs9XG4gICAgICAgICAgICAgICc8cD5Nb3JlIHRoYW4gPHN0cm9uZz4nICtcbiAgICAgICAgICAgICAgZGF0YUVsZW1lbnQuZGF0YVNldHMubGVuZ3RoICtcbiAgICAgICAgICAgICAgJzwvc3Ryb25nPiBkYXRhc2V0IGllICc7XG5cbiAgICAgICAgICAgIGRhdGFFbGVtZW50LmRhdGFTZXRzLmZvckVhY2goXG4gICAgICAgICAgICAgIChkYXRhU2V0OiBhbnksIGRhdGFTZXRJbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgZGF0YVNldEluZGV4ICE9PSAwICYmXG4gICAgICAgICAgICAgICAgICBkYXRhU2V0SW5kZXggIT09IGRhdGFFbGVtZW50LmRhdGFTZXRzLmxlbmd0aCAtIDFcbiAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgIGRhdGFFbGVtZW50RGVzY3JpcHRpb24gKz0gJywgJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICBkYXRhU2V0SW5kZXggPT09IGRhdGFFbGVtZW50LmRhdGFTZXRzLmxlbmd0aCAtIDEgJiZcbiAgICAgICAgICAgICAgICAgIGRhdGFFbGVtZW50LmRhdGFTZXRzLmxlbmd0aCA+IDFcbiAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgIGRhdGFFbGVtZW50RGVzY3JpcHRpb24gKz0gJyBhbmQgJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGF0YUVsZW1lbnREZXNjcmlwdGlvbiArPVxuICAgICAgICAgICAgICAgICAgJzxzdHJvbmc+JyArIGRhdGFTZXQubmFtZSArICc8L3N0cm9uZz4nO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBkYXRhRWxlbWVudERlc2NyaXB0aW9uICs9XG4gICAgICAgICAgICAgICcgdXNlIHRoaXMgJyArIGRhdGFFbGVtZW50Lm5hbWUgKyAnIGRhdGEgZWxlbWVudCc7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgZGF0YUVsZW1lbnQuZGF0YUVsZW1lbnRHcm91cHMgJiZcbiAgICAgICAgICAgICAgZGF0YUVsZW1lbnQuZGF0YUVsZW1lbnRHcm91cHMubGVuZ3RoID4gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGRhdGFFbGVtZW50RGVzY3JpcHRpb24gKz0gJyBhbmQgaXQgYmVsb25ncyB0byAnO1xuXG4gICAgICAgICAgICAgIGRhdGFFbGVtZW50LmRhdGFFbGVtZW50R3JvdXBzLmZvckVhY2goXG4gICAgICAgICAgICAgICAgKGRhdGFFbGVtZW50R3JvdXAsIGRhdGFFbGVtZW50R3JvdXBJbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICBkYXRhRWxlbWVudEdyb3VwSW5kZXggIT09IDAgJiZcbiAgICAgICAgICAgICAgICAgICAgZGF0YUVsZW1lbnRHcm91cEluZGV4ICE9PVxuICAgICAgICAgICAgICAgICAgICAgIGRhdGFFbGVtZW50LmRhdGFFbGVtZW50R3JvdXBzLmxlbmd0aCAtIDFcbiAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhRWxlbWVudERlc2NyaXB0aW9uICs9ICcsICc7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgZGF0YUVsZW1lbnRHcm91cEluZGV4ID09PVxuICAgICAgICAgICAgICAgICAgICAgIGRhdGFFbGVtZW50LmRhdGFFbGVtZW50R3JvdXBzLmxlbmd0aCAtIDEgJiZcbiAgICAgICAgICAgICAgICAgICAgZGF0YUVsZW1lbnQuZGF0YUVsZW1lbnRHcm91cHMubGVuZ3RoID4gMVxuICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFFbGVtZW50RGVzY3JpcHRpb24gKz0gJyBhbmQgJztcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGRhdGFFbGVtZW50RGVzY3JpcHRpb24gKz1cbiAgICAgICAgICAgICAgICAgICAgJzxzdHJvbmc+JyArIGRhdGFFbGVtZW50R3JvdXAubmFtZSArICcgR3JvdXA8L3N0cm9uZz4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGF0YUVsZW1lbnREZXNjcmlwdGlvbiArPSAnPC9wPic7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5zdG9yZS5kaXNwYXRjaChcbiAgICAgICAgICAgIG5ldyBVcGRhdGVEaWN0aW9uYXJ5TWV0YWRhdGFBY3Rpb24oZGF0YUVsZW1lbnRJZCwge1xuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZGF0YUVsZW1lbnREZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgcHJvZ3Jlc3M6IHtcbiAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBsb2FkaW5nU3VjY2VlZGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxvYWRpbmdGYWlsZWQ6IGZhbHNlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cblxuICBnZXRJbmRpY2F0b3JJbmZvKGluZGljYXRvclVybDogc3RyaW5nLCBpbmRpY2F0b3JJZDogc3RyaW5nKSB7XG4gICAgdGhpcy5odHRwQ2xpZW50LmdldChgJHtpbmRpY2F0b3JVcmx9YCwgdHJ1ZSkuc3Vic2NyaWJlKChpbmRpY2F0b3I6IGFueSkgPT4ge1xuICAgICAgbGV0IGluZGljYXRvckRlc2NyaXB0aW9uID1cbiAgICAgICAgJzxwPjxzdHJvbmc+JyArXG4gICAgICAgIGluZGljYXRvci5uYW1lICtcbiAgICAgICAgJzwvc3Ryb25nPiBpcyBhIDxzdHJvbmc+JyArXG4gICAgICAgIGluZGljYXRvci5pbmRpY2F0b3JUeXBlLm5hbWUgK1xuICAgICAgICAnIDwvc3Ryb25nPiBpbmRpY2F0b3InO1xuXG4gICAgICBpZiAoaW5kaWNhdG9yLm51bWVyYXRvckRlc2NyaXB0aW9uKSB7XG4gICAgICAgIGluZGljYXRvckRlc2NyaXB0aW9uICs9XG4gICAgICAgICAgJzxzcGFuPiB3aXRoIHRoZSBudW1lcmF0b3IgZGVzY3JpYmVkIGFzIDxzdHJvbmc+JyArXG4gICAgICAgICAgaW5kaWNhdG9yLm51bWVyYXRvckRlc2NyaXB0aW9uICtcbiAgICAgICAgICAnPC9zdHJvbmc+PC9zcGFuPic7XG4gICAgICB9XG5cbiAgICAgIGlmIChpbmRpY2F0b3IuZGVub21pbmF0b3JEZXNjcmlwdGlvbikge1xuICAgICAgICBpbmRpY2F0b3JEZXNjcmlwdGlvbiArPVxuICAgICAgICAgICc8c3Bhbj4gYW5kIGRlbm9taW5hdG9yIGRlc2NyaWJlZCBhcyA8c3Ryb25nPicgK1xuICAgICAgICAgIGluZGljYXRvci5kZW5vbWluYXRvckRlc2NyaXB0aW9uICtcbiAgICAgICAgICAnPC9zdHJvbmc+PC9zcGFuPic7XG4gICAgICB9XG5cbiAgICAgIGluZGljYXRvckRlc2NyaXB0aW9uICs9ICc8L3A+JztcblxuICAgICAgaWYgKGluZGljYXRvci5hbm51YWxpemVkKSB7XG4gICAgICAgIGluZGljYXRvckRlc2NyaXB0aW9uICs9XG4gICAgICAgICAgJzxwPjxzcGFuPkl04oCZcyBmaWd1cmUgaXMgYW5udWFsaXplZCB0byBzdXBwb3J0IGFuYWx5c2lzIGluIGxlc3MgdGhhbiB5ZWFyIHBlcmlvZCAnICtcbiAgICAgICAgICAnKG1vbnRobHkscXVhcnRlcmx5LHNlbWktYW5udWFsbHkpPC9zcGFuPjwvcD4nO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnN0b3JlLmRpc3BhdGNoKFxuICAgICAgICBuZXcgVXBkYXRlRGljdGlvbmFyeU1ldGFkYXRhQWN0aW9uKGluZGljYXRvcklkLCB7XG4gICAgICAgICAgZGVzY3JpcHRpb246IGluZGljYXRvckRlc2NyaXB0aW9uLFxuICAgICAgICAgIHByb2dyZXNzOiB7XG4gICAgICAgICAgICBsb2FkaW5nOiB0cnVlLFxuICAgICAgICAgICAgbG9hZGluZ1N1Y2NlZWRlZDogdHJ1ZSxcbiAgICAgICAgICAgIGxvYWRpbmdGYWlsZWQ6IGZhbHNlXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgLyoqXG4gICAgICAgKiBHZXQgbnVtZXJhdG9yIGV4cHJlc3Npb25cbiAgICAgICAqL1xuICAgICAgZm9ya0pvaW4oXG4gICAgICAgIHRoaXMuaHR0cENsaWVudC5nZXQoXG4gICAgICAgICAgJ2V4cHJlc3Npb25zL2Rlc2NyaXB0aW9uP2V4cHJlc3Npb249JyArXG4gICAgICAgICAgICBlbmNvZGVVUklDb21wb25lbnQoaW5kaWNhdG9yLm51bWVyYXRvciksXG4gICAgICAgICAgdHJ1ZVxuICAgICAgICApLFxuICAgICAgICB0aGlzLmh0dHBDbGllbnQuZ2V0KFxuICAgICAgICAgICdkYXRhU2V0cy5qc29uP2ZpZWxkcz1wZXJpb2RUeXBlLGlkLG5hbWUsdGltZWx5RGF5cyxmb3JtVHlwZSxjcmVhdGVkLGV4cGlyeURheXMmJyArXG4gICAgICAgICAgICAnZmlsdGVyPWRhdGFTZXRFbGVtZW50cy5kYXRhRWxlbWVudC5pZDppbjpbJyArXG4gICAgICAgICAgICB0aGlzLmdldEF2YWlsYWJsZURhdGFFbGVtZW50cyhpbmRpY2F0b3IubnVtZXJhdG9yKSArXG4gICAgICAgICAgICAnXSZwYWdpbmc9ZmFsc2UnLFxuICAgICAgICAgIHRydWVcbiAgICAgICAgKVxuICAgICAgKS5zdWJzY3JpYmUoKG51bWVyYXRvclJlc3VsdHM6IGFueVtdKSA9PiB7XG4gICAgICAgIGlmIChudW1lcmF0b3JSZXN1bHRzWzBdKSB7XG4gICAgICAgICAgaW5kaWNhdG9yRGVzY3JpcHRpb24gKz1cbiAgICAgICAgICAgICc8cD5OdW1lcmF0b3IgaXMgY2FsY3VsYXRlZCBmcm9tIDxzdHJvbmc+JyArXG4gICAgICAgICAgICBudW1lcmF0b3JSZXN1bHRzWzBdLmRlc2NyaXB0aW9uICtcbiAgICAgICAgICAgICc8L3N0cm9uZz4nO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG51bWVyYXRvclJlc3VsdHNbMV0gJiYgbnVtZXJhdG9yUmVzdWx0c1sxXS5kYXRhU2V0cykge1xuICAgICAgICAgIGNvbnN0IGRhdGFTZXRzOiBhbnlbXSA9IG51bWVyYXRvclJlc3VsdHNbMV0uZGF0YVNldHM7XG5cbiAgICAgICAgICBpZiAoZGF0YVNldHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgaW5kaWNhdG9yRGVzY3JpcHRpb24gKz0gJyBvcmlnaW5hdGluZyBmcm9tICc7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZGF0YVNldHMuZm9yRWFjaCgoZGF0YXNldDogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICBpZiAoaW5kZXggIT09IDAgJiYgaW5kZXggIT09IGRhdGFTZXRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgaW5kaWNhdG9yRGVzY3JpcHRpb24gKz0gJywgJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGluZGV4ID09PSBkYXRhU2V0cy5sZW5ndGggLSAxICYmIGRhdGFTZXRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgaW5kaWNhdG9yRGVzY3JpcHRpb24gKz0gJyBhbmQgJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaW5kaWNhdG9yRGVzY3JpcHRpb24gKz1cbiAgICAgICAgICAgICAgJzxzcGFuPjxzdHJvbmc+JyArXG4gICAgICAgICAgICAgIGRhdGFzZXQubmFtZSArXG4gICAgICAgICAgICAgICcsPC9zdHJvbmc+IHRoYXQgaXMgY29sbGVjdGVkIDxzdHJvbmc+JyArXG4gICAgICAgICAgICAgIGRhdGFzZXQucGVyaW9kVHlwZSArXG4gICAgICAgICAgICAgICc8L3N0cm9uZz4gd2l0aCBkZWFkbGluZSBmb3Igc3VibWlzc2lvbiBhZnRlciA8c3Ryb25nPicgK1xuICAgICAgICAgICAgICBkYXRhc2V0LnRpbWVseURheXMgK1xuICAgICAgICAgICAgICAnIGRheXMgPC9zdHJvbmc+PC9zcGFuPic7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpbmRpY2F0b3JEZXNjcmlwdGlvbiArPSBgPC9wPmA7XG5cbiAgICAgICAgdGhpcy5zdG9yZS5kaXNwYXRjaChcbiAgICAgICAgICBuZXcgVXBkYXRlRGljdGlvbmFyeU1ldGFkYXRhQWN0aW9uKGluZGljYXRvcklkLCB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogaW5kaWNhdG9yRGVzY3JpcHRpb24sXG4gICAgICAgICAgICBwcm9ncmVzczoge1xuICAgICAgICAgICAgICBsb2FkaW5nOiB0cnVlLFxuICAgICAgICAgICAgICBsb2FkaW5nU3VjY2VlZGVkOiB0cnVlLFxuICAgICAgICAgICAgICBsb2FkaW5nRmFpbGVkOiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCBkZW5vbWluYXRvciBleHByZXNzaW9uXG4gICAgICAgICAqL1xuICAgICAgICBmb3JrSm9pbihcbiAgICAgICAgICB0aGlzLmh0dHBDbGllbnQuZ2V0KFxuICAgICAgICAgICAgJ2V4cHJlc3Npb25zL2Rlc2NyaXB0aW9uP2V4cHJlc3Npb249JyArXG4gICAgICAgICAgICAgIGVuY29kZVVSSUNvbXBvbmVudChpbmRpY2F0b3IuZGVub21pbmF0b3IpLFxuICAgICAgICAgICAgdHJ1ZVxuICAgICAgICAgICksXG4gICAgICAgICAgdGhpcy5odHRwQ2xpZW50LmdldChcbiAgICAgICAgICAgICdkYXRhU2V0cy5qc29uP2ZpZWxkcz1wZXJpb2RUeXBlLGlkLG5hbWUsdGltZWx5RGF5cyxmb3JtVHlwZSxjcmVhdGVkLGV4cGlyeURheXMmJyArXG4gICAgICAgICAgICAgICdmaWx0ZXI9ZGF0YVNldEVsZW1lbnRzLmRhdGFFbGVtZW50LmlkOmluOlsnICtcbiAgICAgICAgICAgICAgdGhpcy5nZXRBdmFpbGFibGVEYXRhRWxlbWVudHMoaW5kaWNhdG9yLmRlbm9taW5hdG9yKSArXG4gICAgICAgICAgICAgICddJnBhZ2luZz1mYWxzZScsXG4gICAgICAgICAgICB0cnVlXG4gICAgICAgICAgKVxuICAgICAgICApLnN1YnNjcmliZSgoZGVub21pbmF0b3JSZXN1bHRzOiBhbnlbXSkgPT4ge1xuICAgICAgICAgIGlmIChkZW5vbWluYXRvclJlc3VsdHNbMF0pIHtcbiAgICAgICAgICAgIGluZGljYXRvckRlc2NyaXB0aW9uICs9XG4gICAgICAgICAgICAgICc8cD5EZW5vbWluYXRvciBpcyBjYWxjdWxhdGVkIGZyb20gPHN0cm9uZz4nICtcbiAgICAgICAgICAgICAgZGVub21pbmF0b3JSZXN1bHRzWzBdLmRlc2NyaXB0aW9uICtcbiAgICAgICAgICAgICAgJzwvc3Ryb25nPic7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGRlbm9taW5hdG9yUmVzdWx0c1sxXSAmJiBkZW5vbWluYXRvclJlc3VsdHNbMV0uZGF0YVNldHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGFTZXRzOiBhbnlbXSA9IGRlbm9taW5hdG9yUmVzdWx0c1sxXS5kYXRhU2V0cztcblxuICAgICAgICAgICAgaWYgKGRhdGFTZXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgaW5kaWNhdG9yRGVzY3JpcHRpb24gKz0gJyBvcmlnaW5hdGluZyBmcm9tICc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRhdGFTZXRzLmZvckVhY2goKGRhdGFzZXQ6IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgICBpZiAoaW5kZXggIT09IDAgJiYgaW5kZXggIT09IGRhdGFTZXRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICBpbmRpY2F0b3JEZXNjcmlwdGlvbiArPSAnLCAnO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSBkYXRhU2V0cy5sZW5ndGggLSAxICYmIGRhdGFTZXRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICBpbmRpY2F0b3JEZXNjcmlwdGlvbiArPSAnIGFuZCAnO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaW5kaWNhdG9yRGVzY3JpcHRpb24gKz1cbiAgICAgICAgICAgICAgICAnPHNwYW4+PHN0cm9uZz4nICtcbiAgICAgICAgICAgICAgICBkYXRhc2V0Lm5hbWUgK1xuICAgICAgICAgICAgICAgICcsPC9zdHJvbmc+IHRoYXQgaXMgY29sbGVjdGVkIDxzdHJvbmc+JyArXG4gICAgICAgICAgICAgICAgZGF0YXNldC5wZXJpb2RUeXBlICtcbiAgICAgICAgICAgICAgICAnPC9zdHJvbmc+IHdpdGggZGVhZGxpbmUgZm9yIHN1Ym1pc3Npb24gYWZ0ZXIgPHN0cm9uZz4nICtcbiAgICAgICAgICAgICAgICBkYXRhc2V0LnRpbWVseURheXMgK1xuICAgICAgICAgICAgICAgICcgZGF5cyA8L3N0cm9uZz48L3NwYW4+JztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGluZGljYXRvckRlc2NyaXB0aW9uICs9IGA8L3A+YDtcblxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIEluZGljYXRvciBncm91cFxuICAgICAgICAgICAqL1xuXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgaW5kaWNhdG9yLmluZGljYXRvckdyb3VwcyAmJlxuICAgICAgICAgICAgaW5kaWNhdG9yLmluZGljYXRvckdyb3Vwcy5sZW5ndGggPiAwXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBpbmRpY2F0b3JEZXNjcmlwdGlvbiArPSAnPGRpdj48cD5JdCBiZWxvbmdzIHRvICc7XG5cbiAgICAgICAgICAgIGluZGljYXRvci5pbmRpY2F0b3JHcm91cHMuZm9yRWFjaCgoaW5kaWNhdG9yR3JvdXAsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBpbmRleCAhPT0gMCAmJlxuICAgICAgICAgICAgICAgIGluZGV4ICE9PSBpbmRpY2F0b3IuaW5kaWNhdG9yR3JvdXBzLmxlbmd0aCAtIDFcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgaW5kaWNhdG9yRGVzY3JpcHRpb24gKz0gJywgJztcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBpbmRleCA9PT0gaW5kaWNhdG9yLmluZGljYXRvckdyb3Vwcy5sZW5ndGggLSAxICYmXG4gICAgICAgICAgICAgICAgaW5kaWNhdG9yLmluZGljYXRvckdyb3Vwcy5sZW5ndGggPiAxXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGluZGljYXRvckRlc2NyaXB0aW9uICs9ICcgYW5kICc7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpbmRpY2F0b3JEZXNjcmlwdGlvbiArPVxuICAgICAgICAgICAgICAgICc8c3Bhbj48c3Ryb25nPicgK1xuICAgICAgICAgICAgICAgIGluZGljYXRvckdyb3VwLm5hbWUgK1xuICAgICAgICAgICAgICAgICc8L3N0cm9uZz4gd2l0aCA8c3Ryb25nPicgK1xuICAgICAgICAgICAgICAgIGluZGljYXRvckdyb3VwLmluZGljYXRvcnMgK1xuICAgICAgICAgICAgICAgICc8L3N0cm9uZz4gb3RoZXIgcmVsYXRlZCBpbmRpY2F0b3JzPC9zcGFuPic7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW5kaWNhdG9yRGVzY3JpcHRpb24gKz0gJzwvcD48L2Rpdj4nO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIEF0dHJpYnV0ZSB2YWx1ZXNcbiAgICAgICAgICAgKi9cbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBpbmRpY2F0b3IuYXR0cmlidXRlVmFsdWVzICYmXG4gICAgICAgICAgICBpbmRpY2F0b3IuYXR0cmlidXRlVmFsdWVzLmxlbmd0aCA+IDBcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGluZGljYXRvckRlc2NyaXB0aW9uICs9XG4gICAgICAgICAgICAgICc8ZGl2PjxwPk90aGVyIHJlbGF0ZWQgZGV0YWlscyBhc3NvY2lhdGVkIHdpdGggdGhpcyBpbmRpY2F0b3JzIGluY2x1ZGVzOiAnO1xuXG4gICAgICAgICAgICBpbmRpY2F0b3IuYXR0cmlidXRlVmFsdWVzLmZvckVhY2goYXR0ciA9PiB7XG4gICAgICAgICAgICAgIGluZGljYXRvckRlc2NyaXB0aW9uICs9XG4gICAgICAgICAgICAgICAgJzxzcGFuPjxzdHJvbmc+JyArXG4gICAgICAgICAgICAgICAgYXR0ci5hdHRyaWJ1dGUubmFtZSArXG4gICAgICAgICAgICAgICAgJzogJyArXG4gICAgICAgICAgICAgICAgYXR0ci52YWx1ZSArXG4gICAgICAgICAgICAgICAgJzwvc3Ryb25nPjwvc3Bhbj4nO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGluZGljYXRvckRlc2NyaXB0aW9uICs9ICc8L3A+PC9kaXY+JztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBMZWdlbmQgc2V0XG4gICAgICAgICAgICovXG4gICAgICAgICAgaWYgKGluZGljYXRvci5sZWdlbmRTZXQpIHtcbiAgICAgICAgICAgIGluZGljYXRvckRlc2NyaXB0aW9uICs9XG4gICAgICAgICAgICAgICc8ZGl2PjxwPiBJdCBtYWtlcyB1c2Ugb2Y6IDxzdHJvbmc+JyArXG4gICAgICAgICAgICAgIGluZGljYXRvci5sZWdlbmRTZXQubmFtZSArXG4gICAgICAgICAgICAgICc8L3N0cm9uZz4gbGVnZW5kJyArXG4gICAgICAgICAgICAgICcgc2V0IGZvciBhbmFseXNpcyB3aXRoIDxzdHJvbmc+JyArXG4gICAgICAgICAgICAgIGluZGljYXRvci5sZWdlbmRTZXQubGVnZW5kcyArXG4gICAgICAgICAgICAgICcgQ2xhc3NlcyA8L3N0cm9uZz51c2luZyA8c3Ryb25nPicgK1xuICAgICAgICAgICAgICBpbmRpY2F0b3IubGVnZW5kU2V0LnN5bWJvbGl6ZXIgK1xuICAgICAgICAgICAgICAnIGZvciBhbmFseXNpczwvc3Ryb25nPjwvcD48L2Rpdj4nO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIFVzZXIgaW5mb1xuICAgICAgICAgICAqL1xuICAgICAgICAgIGlmIChpbmRpY2F0b3IudXNlcikge1xuICAgICAgICAgICAgaW5kaWNhdG9yRGVzY3JpcHRpb24gKz1cbiAgICAgICAgICAgICAgJzxkaXY+PHA+VGhpcyBpbmRpY2F0b3Igd2FzIDxzdHJvbmc+IGZpcnN0IGNyZWF0ZWQgPC9zdHJvbmc+IGluIHRoZSBzeXN0ZW0gb24gPHN0cm9uZz4nICtcbiAgICAgICAgICAgICAgdGhpcy5kYXRlUGlwZS50cmFuc2Zvcm0oaW5kaWNhdG9yLmNyZWF0ZWQpICtcbiAgICAgICAgICAgICAgJzwvc3Ryb25nPiBieSA8c3Ryb25nPicgK1xuICAgICAgICAgICAgICBpbmRpY2F0b3IudXNlci5uYW1lICtcbiAgICAgICAgICAgICAgJzwvc3Ryb25nPjwvcD48L2Rpdj4nO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuc3RvcmUuZGlzcGF0Y2goXG4gICAgICAgICAgICBuZXcgVXBkYXRlRGljdGlvbmFyeU1ldGFkYXRhQWN0aW9uKGluZGljYXRvcklkLCB7XG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbmRpY2F0b3JEZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgcHJvZ3Jlc3M6IHtcbiAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBsb2FkaW5nU3VjY2VlZGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxvYWRpbmdGYWlsZWQ6IGZhbHNlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldEF2YWlsYWJsZURhdGFFbGVtZW50cyhkYXRhKSB7XG4gICAgbGV0IGRhdGFFbGVtZW50VWlkcyA9IFtdO1xuICAgIGNvbnN0IHNlcGFyYXRvcnMgPSBbJyAnLCAnXFxcXCsnLCAnLScsICdcXFxcKCcsICdcXFxcKScsICdcXFxcKicsICcvJywgJzonLCAnXFxcXD8nXTtcbiAgICBjb25zdCBudW1lcmF0b3JEYXRhRWxlbWVudHMgPSBkYXRhLnNwbGl0KFxuICAgICAgbmV3IFJlZ0V4cChzZXBhcmF0b3JzLmpvaW4oJ3wnKSwgJ2cnKVxuICAgICk7XG4gICAgbnVtZXJhdG9yRGF0YUVsZW1lbnRzLmZvckVhY2goZGF0YUVsZW1lbnQgPT4ge1xuICAgICAgZGF0YUVsZW1lbnRVaWRzID0gdGhpcy5kYXRhRWxlbWVudFdpdGhDYXRlZ29yeU9wdGlvbkNoZWNrKGRhdGFFbGVtZW50KTtcbiAgICB9KTtcbiAgICByZXR1cm4gZGF0YUVsZW1lbnRVaWRzLmpvaW4oKTtcbiAgfVxuXG4gIGRhdGFFbGVtZW50V2l0aENhdGVnb3J5T3B0aW9uQ2hlY2soZGF0YUVsZW1lbnQ6IGFueSkge1xuICAgIGNvbnN0IHVpZCA9IFtdO1xuICAgIGlmIChkYXRhRWxlbWVudC5pbmRleE9mKCcuJykgPj0gMSkge1xuICAgICAgdWlkLnB1c2goXG4gICAgICAgIGRhdGFFbGVtZW50XG4gICAgICAgICAgLnJlcGxhY2UoLyMvZywgJycpXG4gICAgICAgICAgLnJlcGxhY2UoL3svZywgJycpXG4gICAgICAgICAgLnJlcGxhY2UoL30vZywgJycpXG4gICAgICAgICAgLnNwbGl0KCcuJylbMF1cbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHVpZC5wdXNoKFxuICAgICAgICBkYXRhRWxlbWVudFxuICAgICAgICAgIC5yZXBsYWNlKC8jL2csICcnKVxuICAgICAgICAgIC5yZXBsYWNlKC97L2csICcnKVxuICAgICAgICAgIC5yZXBsYWNlKC99L2csICcnKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdWlkO1xuICB9XG59XG4iXX0=